---
title: "parcial2"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
```{r}
#base gral
dim(datos)
str(datos)
head(datos)

cols<- c("titleType","startYear", "endYear", "runtimeMinutes", "genres_x", "directors", "writers", "language", "types", "attributes", "genres_y", "original_language", "overview", "production_companies", "production_countries", "release_date", "status", "tagline", "video")
  #Le aplicamos una misma función a todas las columnas con lapply  
datos[cols] <- lapply(datos[cols], factor)


datos$seasonNumber<-as.integer(datos$seasonNumber)
datos$episodeNumber<-as.integer(datos$episodeNumber)


# Variable TARGET
# target
barplot(table(datoss$averageRating),main = 'Ingreso Anual',col='blue',ylab = 'Cantidad', xlab = "Target")

table(datos$averageRating)
summary(datos$averageRating)
```

```{r}
#MISSINGS

colSums(datos == "\\N") + colSums(datos == "") 

colSums(is.na(datos))

#Copio base
df_train <- datos

# elimino las que tienen muchos missings

df_train$endYear <- NULL
df_train$language <- NULL
df_train$attributes <- NULL
df_train$adult <- NULL
df_train$genres_y <- NULL
df_train$production_companies <- NULL
df_train$production_countries <- NULL
df_train$overview <- NULL
df_train$original_language <- NULL
df_train$release_date <- NULL
df_train$status <- NULL
df_train$tagline <- NULL
df_train$video <- NULL
df_train$language <- NULL
df_train$types <- NULL

df_train$ordering <- NULL
df_train$budget <- NULL
df_train$popularity <- NULL
df_train$revenue <- NULL
df_train$runtime <- NULL
df_train$isOriginalTitle <- NULL

df_train$id <- NULL


df_train$directors <- NULL
df_train$writers <- NULL
df_train$genres_x <- NULL

#language: porahi poner los que estan y others/unksnown

# igual con status y release date, endYear: 830 mil datos de status faltan y no tienen end date, y 430 mil peliculas released no tienen end date

table(datos$endYear, datos$status)

#start day hace mas de 50 anios: no puedo suponer que todavia no se termino de filmar. Capaz el dato falta
#ordering: NA's: no puedo suponer 0 porque cambia


#NUMERO DE EPISODIOS POR TIPO DE titulo
table(datos$episodeNumber, datos$titleType)

#NUMERO DE TEMPORADAS POR TIPO DE titulo
table(datos$seasonNumber, datos$titleType)

# # SOLO TIENEN NUMERO DE EPISODIOS Y TEMPORADAS LOS TVEPISODES: AL RES



# cambio season numer y episode number por 0 si es na
df_train$episodeNumber[is.na(df_train$episodeNumber)] <- 0
df_train$seasonNumber[is.na(df_train$seasonNumber)] <- 0


# vuelvo a ver missings de la nueva

colSums(df_train == "\\N") + colSums(df_train == "") 

colSums(is.na(df_train))


# isAdult
table(df_train$isAdult)
df_train$isAdult[df_train$isAdult == "2020"] <- "0"
df_train$isAdult[is.na(df_train$isAdult)] <- "0"

#Title
table(df_train$titleType)


#Lo reemplazo por el tipo que tenga un avg rating mas similar 

library(dplyr)
df_train %>%
  group_by(titleType) %>%
  summarise(tiempoPRom=mean(averageRating))

df_train$titleType[df_train$titleType == ""] <- "tvEpisode"


str(df_train)

#YEAR
df_train$startYear <- as.numeric(levels(df_train$startYear))[df_train$startYear]  
mean(df_train$startYear, na.rm = TRUE)
  ## ANIO PROMEDIO 2000

# remplazo missings por media = 2000
df_train$startYear[df_train$startYear == ""] <- "2000"
df_train$startYear[df_train$startYear == "\\N"] <- "2000"


# runtime minutes

df_train$runtimeMinutes[df_train$runtimeMinutes == "\\N"] <- is.na(df_train$runtimeMinutes)
df_train$runtimeMinutes <- as.numeric(df_train$runtimeMinutes)


df_train %>%
  group_by(titleType) %>%
  summarise(tiempoPRom=mean(runtimeMinutes, na.rm = TRUE))

df_train$runtimeMinutes[df_train$titleType == "movie" & is.na(df_train$runtimeMinutes)] <- 439
df_train$runtimeMinutes[df_train$titleType == "short" & is.na(df_train$runtimeMinutes)] <- 255
df_train$runtimeMinutes[df_train$titleType == "tvEpisode" & is.na(df_train$runtimeMinutes)] <- 331
df_train$runtimeMinutes[df_train$titleType == "tvMiniSeries" & is.na(df_train$runtimeMinutes)] <- 329
df_train$runtimeMinutes[df_train$titleType == "tvMovie" & is.na(df_train$runtimeMinutes)] <- 452
df_train$runtimeMinutes[df_train$titleType == "tvSeries" & is.na(df_train$runtimeMinutes)] <- 344
df_train$runtimeMinutes[df_train$titleType == "tvShort" & is.na(df_train$runtimeMinutes)] <- 234
df_train$runtimeMinutes[df_train$titleType == "tvSpecial" & is.na(df_train$runtimeMinutes)] <- 350
df_train$runtimeMinutes[df_train$titleType == "video" & is.na(df_train$runtimeMinutes)] <- 378
df_train$runtimeMinutes[df_train$titleType == "videoGame" & is.na(df_train$runtimeMinutes)] <- 339

```


```{r}
#Normalizo y estandarizo

# numvotos

df_train$numVotes<-scale(df_train$numVotes)
summary(df_train$numVotes)
sd(df_train$numVotes)

# runtime

df_train$runtimeMinutes<-scale(df_train$runtimeMinutes)
summary(df_train$runtimeMinutes)
sd(df_train$runtimeMinutes)

# season num
df_train$seasonNumber<-scale(df_train$seasonNumber)

# episode num
df_train$episodeNumber<-scale(df_train$episodeNumber)

# start year
aa = df_train
aa$startYear<-scale(aa$startYear)
```

```{r}
# Chi cuadrado

# Si el valor p es menor que o igual al nivel de significancia, se rechaza la hipótesis nula y concluye que hay una asociación estadísticamente significativa entre las variables.

#Ho: variables independientes
# Si rechazo hay una asociacion estadisticamente significativa entre las variables

# num votes
tabla2 <- table(df_train$averageRating,df_train$numVotes)

chisq.test(tabla2)    # valor P < 0.05


# titleType A DUMMIES

installed.packages("fastDummies")
library(fastDummies)
dumm_data <-dummy_cols(df_train,  select_columns = c("titleType")) %>% 
  select(-c("titleType"))

dumm_data$titleType_ <- NULL
#dumm_data$titleType_movie <- NULL     ## dicotoma base (si ninguna otra toma el valor 1, es movie)
str(dumm_data)


# runtime minutes

tabla3 <- table(df_train$averageRating,df_train$runtimeMinutes)

chisq.test(tabla3)    # valor P < 0.05

# season num
tabla4 <- table(df_train$averageRating,df_train$seasonNumber)

chisq.test(tabla4)    # valor P < 0.05

# episode num
tabla5 <- table(df_train$averageRating,df_train$episodeNumber)

chisq.test(tabla5)    # valor P < 0.05

# start year
tabla6 <- table(df_train$averageRating,df_train$startYear)

chisq.test(tabla6)    # valor P < 0.05

# is adult
tabla7 <- table(df_train$averageRating,df_train$isAdult)

chisq.test(tabla7)    # valor P < 0.05


```


```{r}
# ANALISIS UNI

# num vote

library(ggplot2)

summary(df_train$numVotes)
boxplot(df_train$numVotes,
        main = "Distribucion de cantidad hijos",
        ylab = "hijos",
        col = "lightblue",
        border = "blue")



# start year
boxplot(df_train$startYear,
        main = "Distribucion fecha comienzo",
        ylab = "Fecha",
        col = "purple",
        border = "blue")
summary(df_train$startYear)


```

